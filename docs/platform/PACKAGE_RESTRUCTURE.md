# パッケージ構成変更計画

## 概要

AetherTermプロジェクトのパッケージ構成を以下のように変更します：

### 現在の構成
```
src/aetherterm/
├── shell/          # シェル機能（AI連携ラッパー）
└── server/         # Webサーバー機能
```

### 変更後の構成
```
src/aetherterm/
├── agentshell/     # AIエージェント統合シェル機能
├── agentserver/    # AIエージェント統合Webサーバー機能
└── controlserver/  # 制御サーバー機能（新規開発予定）
```

## 変更理由

1. **役割の明確化**: 各パッケージの役割をより明確に表現
   - `agentshell`: AI エージェント機能を統合したシェル
   - `agentserver`: AI エージェント機能を統合したWebサーバー
   - `controlserver`: システム全体を制御する管理サーバー

2. **将来の拡張性**: 新しい `controlserver` パッケージの追加に備えた構成

3. **アーキテクチャの整理**: 3層構造による責任分離
   - **AgentShell**: ターミナル操作とAI連携
   - **AgentServer**: Web UI とリアルタイム通信
   - **ControlServer**: システム管理と制御

## 各パッケージの役割

### aetherterm.agentshell
- **旧名**: `aetherterm.shell`
- **役割**: AIエージェント統合シェル機能
- **主要機能**:
  - ターミナル操作の監視
  - AI プロバイダーとの連携
  - セッション管理
  - PTY制御
  - テレメトリー収集

### aetherterm.agentserver
- **旧名**: `aetherterm.server`
- **役割**: AIエージェント統合Webサーバー機能
- **主要機能**:
  - Web UI の提供
  - WebSocket通信
  - 静的ファイル配信
  - 認証・セキュリティ
  - ターミナルエミュレーション

### aetherterm.controlserver（新規開発予定）
- **役割**: システム全体の制御・管理サーバー
- **予定機能**:
  - 複数セッション管理
  - システム監視
  - 設定管理
  - ログ集約
  - パフォーマンス監視
  - セキュリティ管理

## 変更作業項目

### 1. ディレクトリ構造の変更
- [ ] `src/aetherterm/shell/` → `src/aetherterm/agentshell/`
- [ ] `src/aetherterm/server/` → `src/aetherterm/agentserver/`
- [ ] テストディレクトリの対応する変更

### 2. インポート文の更新
- [ ] 全Pythonファイルのインポート文修正
- [ ] `from aetherterm.shell` → `from aetherterm.agentshell`
- [ ] `from aetherterm.server` → `from aetherterm.agentserver`

### 3. 設定ファイルの更新
- [ ] `pyproject.toml` のエントリーポイント修正
- [ ] 各種設定ファイルのパス修正

### 4. ドキュメントの更新
- [ ] README.md の更新
- [ ] 技術ドキュメントの更新
- [ ] `.clinerules` の更新

### 5. テストの更新
- [ ] テストファイルのインポート修正
- [ ] テストパスの修正

## 影響範囲

### 直接影響
- Python インポート文
- 設定ファイル
- テストファイル
- ドキュメント

### 間接影響
- 開発環境の設定
- CI/CD パイプライン
- デプロイメント設定

## 移行手順

1. **準備フェーズ**
   - 現在の構成の完全バックアップ
   - 依存関係の洗い出し

2. **ディレクトリ移行フェーズ**
   - ディレクトリ名の変更
   - ファイル移動の確認

3. **コード更新フェーズ**
   - インポート文の一括更新
   - 設定ファイルの更新

4. **テスト・検証フェーズ**
   - 全テストの実行
   - 動作確認

5. **ドキュメント更新フェーズ**
   - 関連ドキュメントの更新
   - 開発ガイドの修正

## 注意事項

- 大規模な変更のため、段階的に実施
- 各段階でテストを実行し、動作確認を行う
- バックアップを必ず取得してから作業開始
- 外部依存関係への影響を慎重に確認

## 今後の開発方針

### controlserver の設計方針
- **マイクロサービス指向**: 独立したサービスとして設計
- **API ファースト**: REST API + GraphQL による制御
- **監視・観測性**: メトリクス、ログ、トレーシングの統合
- **スケーラビリティ**: 水平スケーリング対応
- **セキュリティ**: 認証・認可の一元管理

### アーキテクチャの進化
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AgentShell    │    │   AgentServer   │    │  ControlServer  │
│                 │    │                 │    │                 │
│ • AI連携        │◄──►│ • Web UI        │◄──►│ • システム管理  │
│ • ターミナル制御│    │ • WebSocket     │    │ • セッション管理│
│ • セッション    │    │ • 静的配信      │    │ • 監視・ログ    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

この構成により、各コンポーネントの責任が明確になり、保守性と拡張性が向上します。