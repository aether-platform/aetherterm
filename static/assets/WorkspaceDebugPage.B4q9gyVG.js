import{u as Y,a as Z,g as ee,W as te,_ as oe}from"./index.DNSo4Phz.js";import{j as se,d as y,h as x,G as ae,T as ne,_ as le,X as s,V as a,S as m,n as o,N as l,y as t,L as r,J as S,K as V,F as re,M as de}from"./vue-vendor.oiotgX_B.js";import"./socket.B_mMAB35.js";import"./terminal.dC09zdKq.js";import"./vuetify.CMZzXhov.js";const ie={class:"font-weight-bold"},ce={class:"font-weight-bold"},ue={class:"font-weight-bold"},pe={class:"overflow-auto"},_e={class:"overflow-auto"},fe={class:"text-caption"},me={key:0,class:"ml-2 text-caption"},ve={key:0,class:"text-caption text--secondary"},we=se({__name:"WorkspaceDebugPage",setup(ke){const N=y(`window_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),v=Y(),w=Z(),W=y(!1),_=y({workspaceIds:[],currentWorkspaceId:null,workspaceDetails:[]}),i=y([]),D=ee(),c=x(()=>v.currentWorkspace),C=x(()=>w.connectionState.isConnected),P=x(()=>w.getSocket()?.id||null),$=x(()=>{const n=[];return w.sessions.forEach((e,u)=>{n.push({id:u,type:e.type,terminalId:e.terminalId,isActive:e.isActive,createdAt:e.createdAt})}),n}),E=[{text:"Session ID",value:"id"},{text:"Type",value:"type"},{text:"Terminal ID",value:"terminalId"},{text:"Active",value:"isActive"},{text:"Created",value:"createdAt"}],k=async()=>{W.value=!0;try{const n=JSON.parse(localStorage.getItem("aetherterm_workspaces")||"[]"),e=localStorage.getItem("aetherterm_current_workspace"),u=[];for(const I of n){const f=localStorage.getItem(`aetherterm_workspaces_${I}`);f&&u.push(JSON.parse(f))}_.value={workspaceIds:n,currentWorkspaceId:e,workspaceDetails:u},C.value||await w.connect()}finally{W.value=!1}},F=()=>{const n=v.createWorkspace(`Test Workspace ${Date.now()}`);console.log("Created test workspace:",n),k()},H=()=>{c.value&&(D.broadcastUpdate(c.value),console.log("Broadcasted workspace update"))},U=()=>{confirm("Are you sure you want to clear all workspace data from localStorage?")&&(te.clearAll(),k())},L=n=>n?(n instanceof Date?n:new Date(n)).toLocaleString():"N/A",j=n=>new Date(n).toLocaleTimeString(),z=n=>{i.value.unshift({...n,fromThisWindow:!1}),i.value.length>20&&(i.value=i.value.slice(0,20))};return ae(async()=>{console.log("WorkspaceDebugPage mounted with window ID:",N.value),D.addListener("debug-page",z),await k(),v.hasCurrentWorkspace||await v.initialize()}),ne(()=>{D.removeListener("debug-page")}),(n,e)=>{const u=a("v-card-title"),I=a("v-card-subtitle"),f=a("v-chip"),M=a("v-simple-table"),p=a("v-col"),B=a("v-row"),O=a("v-divider"),T=a("v-expansion-panel-header"),A=a("v-expansion-panel-content"),h=a("v-expansion-panel"),G=a("v-expansion-panels"),K=a("v-data-table"),J=a("v-card"),g=a("v-icon"),b=a("v-btn"),R=a("v-alert"),X=a("v-card-text"),q=a("v-container");return m(),le(q,{fluid:"",class:"pa-4"},{default:s(()=>[o(J,{elevation:"2",class:"mb-4"},{default:s(()=>[o(u,null,{default:s(()=>e[0]||(e[0]=[l("Workspace Session Debug Tool")])),_:1,__:[0]}),o(I,null,{default:s(()=>e[1]||(e[1]=[l("Check if sessions are shared across browser windows")])),_:1,__:[1]}),o(X,null,{default:s(()=>[o(B,null,{default:s(()=>[o(p,{cols:"12",md:"6"},{default:s(()=>[e[5]||(e[5]=t("div",{class:"text-h6 mb-2"},"Window Information",-1)),o(M,{dense:""},{default:s(()=>[t("tbody",null,[t("tr",null,[e[2]||(e[2]=t("td",null,"Window ID (generated)",-1)),t("td",ie,r(N.value),1)]),t("tr",null,[e[3]||(e[3]=t("td",null,"Socket ID",-1)),t("td",ce,r(P.value||"Not connected"),1)]),t("tr",null,[e[4]||(e[4]=t("td",null,"Socket Connected",-1)),t("td",null,[o(f,{color:C.value?"success":"error",small:""},{default:s(()=>[l(r(C.value?"Connected":"Disconnected"),1)]),_:1},8,["color"])])])])]),_:1})]),_:1,__:[5]}),o(p,{cols:"12",md:"6"},{default:s(()=>[e[10]||(e[10]=t("div",{class:"text-h6 mb-2"},"Current Workspace",-1)),o(M,{dense:""},{default:s(()=>[t("tbody",null,[t("tr",null,[e[6]||(e[6]=t("td",null,"Workspace ID",-1)),t("td",ue,r(c.value?.id||"None"),1)]),t("tr",null,[e[7]||(e[7]=t("td",null,"Workspace Name",-1)),t("td",null,r(c.value?.name||"N/A"),1)]),t("tr",null,[e[8]||(e[8]=t("td",null,"Tab Count",-1)),t("td",null,r(c.value?.tabs?.length||0),1)]),t("tr",null,[e[9]||(e[9]=t("td",null,"Last Accessed",-1)),t("td",null,r(L(c.value?.lastAccessed)),1)])])]),_:1})]),_:1,__:[10]})]),_:1}),o(O,{class:"my-4"}),e[22]||(e[22]=t("div",{class:"text-h6 mb-2"},"LocalStorage Data",-1)),o(G,{class:"mb-4"},{default:s(()=>[o(h,null,{default:s(()=>[o(T,null,{default:s(()=>[l(" Workspace List ("+r(_.value.workspaceIds?.length||0)+" workspaces) ",1)]),_:1}),o(A,null,{default:s(()=>[t("pre",pe,r(JSON.stringify(_.value.workspaceIds,null,2)),1)]),_:1})]),_:1}),o(h,null,{default:s(()=>[o(T,null,{default:s(()=>e[11]||(e[11]=[l(" Current Workspace ID ")])),_:1,__:[11]}),o(A,null,{default:s(()=>[t("pre",null,r(_.value.currentWorkspaceId||"None"),1)]),_:1})]),_:1}),o(h,null,{default:s(()=>[o(T,null,{default:s(()=>e[12]||(e[12]=[l(" Workspace Details ")])),_:1,__:[12]}),o(A,null,{default:s(()=>[t("pre",_e,r(JSON.stringify(_.value.workspaceDetails,null,2)),1)]),_:1})]),_:1})]),_:1}),e[23]||(e[23]=t("div",{class:"text-h6 mb-2"},"Active Sessions",-1)),o(K,{headers:E,items:$.value,dense:"",class:"elevation-1 mb-4"},{"item.createdAt":s(({item:d})=>[l(r(L(d.createdAt)),1)]),_:1},8,["items"]),e[24]||(e[24]=t("div",{class:"text-h6 mb-2"},"Cross-Tab Sync Messages",-1)),o(J,{outlined:"",class:"pa-2 mb-4",style:{"max-height":"200px","overflow-y":"auto"}},{default:s(()=>[(m(!0),S(re,null,de(i.value,(d,Q)=>(m(),S("div",{key:Q,class:"mb-1"},[o(f,{"x-small":"",color:d.fromThisWindow?"primary":"secondary",class:"mr-2"},{default:s(()=>[l(r(d.type),1)]),_:2},1032,["color"]),t("span",fe,r(j(d.timestamp)),1),d.workspaceId?(m(),S("span",me,"ID: "+r(d.workspaceId),1)):V("",!0)]))),128)),i.value.length===0?(m(),S("div",ve," No cross-tab messages yet. Open another window to test. ")):V("",!0)]),_:1}),o(O,{class:"my-4"}),e[25]||(e[25]=t("div",{class:"text-h6 mb-2"},"Actions",-1)),o(B,null,{default:s(()=>[o(p,{cols:"auto"},{default:s(()=>[o(b,{color:"primary",onClick:k,loading:W.value},{default:s(()=>[o(g,{left:""},{default:s(()=>e[13]||(e[13]=[l("mdi-refresh")])),_:1,__:[13]}),e[14]||(e[14]=l(" Refresh Data "))]),_:1,__:[14]},8,["loading"])]),_:1}),o(p,{cols:"auto"},{default:s(()=>[o(b,{color:"secondary",onClick:F},{default:s(()=>[o(g,{left:""},{default:s(()=>e[15]||(e[15]=[l("mdi-plus")])),_:1,__:[15]}),e[16]||(e[16]=l(" Create Test Workspace "))]),_:1,__:[16]})]),_:1}),o(p,{cols:"auto"},{default:s(()=>[o(b,{color:"info",onClick:H},{default:s(()=>[o(g,{left:""},{default:s(()=>e[17]||(e[17]=[l("mdi-broadcast")])),_:1,__:[17]}),e[18]||(e[18]=l(" Broadcast Test Message "))]),_:1,__:[18]})]),_:1}),o(p,{cols:"auto"},{default:s(()=>[o(b,{color:"warning",onClick:U},{default:s(()=>[o(g,{left:""},{default:s(()=>e[19]||(e[19]=[l("mdi-delete")])),_:1,__:[19]}),e[20]||(e[20]=l(" Clear LocalStorage "))]),_:1,__:[20]})]),_:1})]),_:1}),o(R,{type:"info",class:"mt-4",outlined:""},{default:s(()=>e[21]||(e[21]=[t("div",{class:"font-weight-bold mb-2"},"How to test session sharing:",-1),t("ol",null,[t("li",null,"Open this page in two different browser windows (not tabs)"),t("li",null,"Check if both windows show the same Workspace ID"),t("li",null,"Create a workspace in one window and refresh the other"),t("li",null,"The workspace should appear in both windows if sharing works correctly"),t("li",null,"Check the Cross-Tab Sync Messages to see if broadcasts are received")],-1)])),_:1,__:[21]})]),_:1,__:[22,23,24,25]})]),_:1})]),_:1})}}}),We=oe(we,[["__scopeId","data-v-d43dfec4"]]);export{We as default};
